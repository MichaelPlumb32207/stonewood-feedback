<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Stonewood Cabins ‚Äì Quick Feedback</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    body {font-family:system-ui;background:#f9fafb;padding:2rem;text-align:center;margin:0;}
    .card {background:white;max-width:500px;margin:2rem auto;padding:2rem;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.1);}
    .btn-happy {background:#10b981;color:white;padding:1.2rem 2.5rem;border-radius:12px;border:none;font-size:1.4rem;}
    .grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin:2rem 0;}
  </style>
</head>
<body>
<div class="card" x-data="app()">
  <h1 style="color:#1e40af;margin-bottom:0.5rem">Stonewood Cabins</h1>
  <h2 x-show="cabin">Cabin <span x-text="cabin"></span> ‚Äì <span x-text="prettyRoom"></span></h2>

  <!-- Happy path (only if no room scanned) -->
  <div x-show="!room && !happy">
    <button class="btn-happy" @click="happy=true">Everything is perfect üòä</button>
  </div>

  <!-- Issue selection ‚Äì auto-shown when a room tag is scanned -->
  <div x-show="room && !selected">
    <p style="font-size:1.2rem;margin:2rem 0;font-weight:600">What needs a look?</p>
    <div class="grid">
      <template x-for="opt in options">
        <button @click="selected=opt" style="padding:1rem;background:#e5e7eb;border-radius:8px;font-weight:600">
          <span x-text="opt"></span>
        </button>
      </template>
    </div>
    <button @click="selected='Other / General Comment'" style="margin:1rem;padding:1rem;background:#ddd;border-radius:8px">
      Other / General Comment
    </button>
  </div>

  <!-- Happy submission -->
  <div x-show="happy && !sent">
    <p style="font-size:1.3rem;margin:2rem 0">Awesome! Want to leave a quick note?</p>
    <textarea x-model="comment" placeholder="Optional ‚Äì we love hearing what you enjoyed!" style="width:90%;height:120px;padding:1rem"></textarea><br><br>
    <button @click="submit('happy')" style="background:#3b82f6;color:white;padding:1rem 2rem;border:none;border-radius:8px">Send Thank You ‚Üí</button>
  </div>

  <!-- Issue details -->
  <div x-show="selected && !sent">
    <p style="font-weight:600;margin:1.5rem 0">Selected: <span x-text="selected"></span></p>
    <textarea x-model="comment" placeholder="Details (optional)" style="width:90%;height:120px;padding:1rem"></textarea><br><br>
    <input type="tel" x-model="phone" placeholder="Phone (optional ‚Äì for updates)" style="padding:0.8rem;width:90%;margin:0.5rem 0"><br>
    <label style="font-size:0.9rem"><input type="checkbox" required> OK to text me updates</label><br><br>
    <button @click="submit('issue')" style="background:#dc2626;color:white;padding:1rem 2rem;border:none;border-radius:8px;font-size:1.2rem">
      Send Report ‚Üí
    </button>
  </div>

  <div x-show="sent" style="margin:4rem;font-size:1.8rem;line-height:1.4">
    ‚úÖ Thank you!<br><br>We‚Äôve got it and will take care of it right away.
  </div>
</div>

<script>
function app() {
  const params = new URLSearchParams(location.search);
  const roomMap = {
    'master-bedroom': 'Master Bedroom',
    'guest-bedroom': 'Guest Bedroom',
    'kitchen': 'Kitchen',
    'living-hot-tub': 'Living Room / Hot Tub',
    'deck-hot-tub': 'Deck / Hot Tub',
    'bathroom': 'Bathroom'
  };
  const roomOptions = {
    'master-bedroom': ['TV', 'Light', 'Bed', 'Window', 'Door', 'Floor', 'Other'],
    'guest-bedroom':  ['TV', 'Light', 'Bed', 'Window', 'Door', 'Floor', 'Other'],
    'kitchen':        ['Sink', 'Stove/Oven', 'Fridge', 'Coffee Maker', 'Microwave', 'Lights', 'Window', 'Floor', 'Door'],
    'living-hot-tub': ['Hot Tub', 'Fireplace', 'WiFi', 'TV', 'Seating'],
    'deck-hot-tub':   ['Hot Tub', 'Seating', 'Lighting'],
    'bathroom':       ['Toilet', 'Shower', 'Sink', 'Mirror', 'Lights'],
    'default':        ['Cleanliness', 'Noise', 'Temperature', 'Hot Tub', 'TV', 'Other']
  };

  return {
    cabin: params.get('c') || 'Guest',
    room: params.get('room') || '',
    prettyRoom: roomMap[params.get('room') || ''] || 'Your Stay',
    options: roomOptions[params.get('room') || ''] || roomOptions.default,
    happy: false,
    selected: '',
    comment: '',
    phone: '',
    sent: false,

    submit(type) {
      fetch('https://n8n.yourdomain.com/webhook/stonewood-feedback', {  // ‚Üê replace with your real n8n URL
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          cabin: this.cabin,
          room: this.room,
          prettyRoom: this.prettyRoom,
          type,
          issue: this.selected || 'N/A',
          comment: this.comment || '',
          phone: this.phone || null,
          timestamp: new Date().toISOString(),
          url: location.href
        })
      });
      this.sent = true;
    }
  };
}
</script>
</body>
</html>
